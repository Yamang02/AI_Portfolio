sequenceDiagram
    participant Dev as 개발자
    participant GH as GitHub
    participant GA as GitHub Actions
    participant GCR as Container Registry
    participant CR as Cloud Run
    participant RailwayDB as Railway Database
    participant AI as Gemini AI

    Dev->>GH: 코드 푸시 (main/staging/develop branch)
    GH->>GA: 워크플로우 트리거
    
    Note over GA: 테스트 단계
    GA->>GA: JDK 17 설정
    GA->>GA: Maven 캐시 설정
    GA->>GA: Backend 빌드 (테스트 스킵)
    
    Note over GA: 멀티스테이지 Docker 빌드
    GA->>GA: Google Cloud 인증
    GA->>GA: Cloud SDK 설정
    GA->>GA: Docker 설정
    
    GA->>GA: Frontend 빌드 (Node.js 18)
    GA->>GA: Backend 빌드 (Maven + JDK 17)
    GA->>GA: 통합 Docker 이미지 생성
    
    GA->>GCR: Docker 이미지 푸시
    GCR-->>GA: 이미지 업로드 완료
    
    alt main branch (프로덕션)
        GA->>CR: ai-portfolio 서비스 배포
        Note over CR: 1Gi 메모리, 1 CPU, 최대 20 인스턴스<br/>production profile
    else staging/develop branch (스테이징)
        GA->>CR: ai-portfolio-staging 서비스 배포
        Note over CR: 1Gi 메모리, 1 CPU, 최대 10 인스턴스<br/>staging profile
    end
    
    CR-->>GA: 배포 완료
    
    Note over CR: 서비스 실행 중
    CR->>RailwayDB: PostgreSQL 연결
    RailwayDB-->>CR: 데이터 응답
    CR->>AI: Gemini API 호출
    AI-->>CR: AI 응답 반환 